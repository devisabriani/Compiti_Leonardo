      - name: Build ICS (debug-safe)
        env:
          ARGO_SCHOOL_CODE: ${{ secrets.ARGO_SCHOOL_CODE }}
          ARGO_USERNAME: ${{ secrets.ARGO_USERNAME }}
          ARGO_PASSWORD: ${{ secrets.ARGO_PASSWORD }}
        run: |
          set -e
          python - <<'PY'
          import os, sys, traceback
          from pathlib import Path

          print("Python:", sys.version)
          print("Env present:", all(k in os.environ for k in ["ARGO_SCHOOL_CODE","ARGO_USERNAME","ARGO_PASSWORD"]))

          try:
              import argofamiglia
              print("argofamiglia version:", getattr(argofamiglia, "__version__", "unknown"))
          except Exception as e:
              print("Import argofamiglia FAILED:", e)
              raise

          # esegui lo script vero e proprio
          import build_homework_calendar
          try:
              build_homework_calendar.main()
              print("Script OK")
          except Exception as e:
              print("Script FAILED:", e)
              traceback.print_exc()
              # crea comunque docs/compiti.ics minimale, cosÃ¬ puoi verificarne l'esistenza
              Path("docs").mkdir(parents=True, exist_ok=True)
              Path("docs/compiti.ics").write_text(
                  "BEGIN:VCALENDAR\r\nEND:VCALENDAR\r\n", encoding="utf-8"
              )
              # esci con codice 1 per vedere il traceback in Actions
              sys.exit(1)
          PY
